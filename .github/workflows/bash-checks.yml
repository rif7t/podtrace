name: Bash Script Checks

on:
  push:
    branches: ["**"]
    paths:
      - "**/*.sh"
  pull_request:
    branches: ["main"]
    paths:
      - "**/*.sh"

jobs:
  bash-lint:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install tools
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            shellcheck \
            devscripts \
            bashate \
            shfmt

      - name: Syntax Check
        run: |
          echo "Running bash syntax check..."
          for file in $(git ls-files '*.sh'); do
            echo "â†’ Checking syntax: $file"
            bash -n "$file"
          done

      - name: Run ShellCheck
        run: |
          echo "Running strict ShellCheck..."
          shellcheck --enable=all -x $(git ls-files '*.sh')

      - name: Check for bashisms
        run: |
          echo "Checking for bashisms..."
          checkbashisms $(git ls-files '*.sh')

      - name: Run bashate
        run: |
          echo "Running bashate..."
          bashate $(git ls-files '*.sh')

      - name: Check formatting (shfmt)
        run: |
          echo "Checking formatting with shfmt..."
          shfmt -d .
