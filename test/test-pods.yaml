---
apiVersion: v1
kind: Namespace
metadata:
  name: podtrace-test
---
apiVersion: v1
kind: Pod
metadata:
  name: nginx-test
  namespace: podtrace-test
  labels:
    app: nginx
    test: podtrace
spec:
  containers:
  - name: nginx
    image: nginx:alpine
    ports:
    - containerPort: 80
    - containerPort: 3000
    command: ["/bin/sh", "-c"]
    args:
    - |
      nginx
      while true; do
        wget -q -O /dev/null http://localhost/ || true
        nslookup google.com || true
        sleep 5
      done
---
apiVersion: v1
kind: Pod
metadata:
  name: busybox-test
  namespace: podtrace-test
  labels:
    app: busybox
    test: podtrace
spec:
  containers:
  - name: busybox
    image: busybox:latest
    command: ["/bin/sh", "-c"]
    args:
    - |
      apk add --no-cache curl bind-tools 2>/dev/null || true
      while true; do
        nslookup kubernetes.default.svc.cluster.local || true
        nslookup google.com || true
        wget -q -O /dev/null http://www.google.com || true
        echo "test $(date)" >> /tmp/test.log
        sync
        sleep 3
      done
---
apiVersion: v1
kind: Pod
metadata:
  name: alpine-test
  namespace: podtrace-test
  labels:
    app: alpine
    test: podtrace
spec:
  containers:
  - name: alpine
    image: alpine:latest
    command: ["/bin/sh", "-c"]
    args:
    - |
      apk add --no-cache curl bind-tools
      while true; do
        curl -s --max-time 5 http://www.google.com > /dev/null || true
        nslookup github.com || true
        echo "$(date) - test log entry" >> /var/log/app.log
        sync
        sleep 4
      done
